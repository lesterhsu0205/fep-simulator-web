client_body_temp_path /tmp/client_temp;
proxy_temp_path       /tmp/proxy_temp_path;
fastcgi_temp_path     /tmp/fastcgi_temp;
uwsgi_temp_path       /tmp/uwsgi_temp;
scgi_temp_path        /tmp/scgi_temp;

server {
    listen 5173;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;
    
    # ============================================================
    # 啟用靜態壓縮 (Static Compression)
    # 這裡的設定是全域有效的，會應用到下面的所有 location
    # ============================================================
    
    # 1. 開啟 Gzip 靜態模組 (優先傳送 .gz 檔)
    # 當瀏覽器請求 xxx.js 時，Nginx 會先檢查有沒有 xxx.js.gz
    gzip on;
    gzip_static on;
    gzip_proxied any;
    gzip_types text/plain
            text/css
            text/xml
            text/javascript
            application/json
            application/javascript
            application/x-javascript
            application/xml 
            application/xml+rss
            image/svg+xml;
    gzip_vary on;

    # 2. 開啟 Brotli 靜態模組 (優先傳送 .br 檔)
    # 注意：這需要你的 Nginx 有安裝 ngx_brotli 模組
    # 如果你的 Docker Image 是標準版 (nginx:alpine)，這行可能會導致啟動失敗
    # 如果報錯，請暫時註解掉下面這行，或者改用 fholzer/nginx-brotli 等支援的 Image
    # brotli_static on;

    # ============================================================
    
    # 處理沒有結尾斜線的情況（使用相對路徑）
    location = /${APP_BASE_PATH} {
        return 302 ./${APP_BASE_PATH}/;
    }
    
    # 處理子路徑的 SPA 路由
    location /${APP_BASE_PATH}/ {
        try_files $uri $uri/ /${APP_BASE_PATH}/index.html;
    }

    # 靜態資源快取
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
